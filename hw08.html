<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>hw08.knit</title>

<script src="site_libs/header-attrs-2.20/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!DOCTYPE html>
<head>
<!-- Favicon for various operating systems -->
<link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
<!-- <link rel="manifest" href="./favicon/site.webmanifest"> -->
<link rel="mask-icon" href="./favicon/safari-pinned-tab.svg" color="#603cba">
<link rel="shortcut icon" href="./favicon/favicon.ico">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-config" content="./favicon/browserconfig.xml">
<meta name="theme-color" content="#382121">
</head>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BIOL3800</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="software.html">Getting started</a>
</li>
<li>
  <a href="content.html">Course content</a>
</li>
<li>
  <a href="survival.html">Survival guide</a>
</li>
<li>
  <a href="resources.html">Additional resources</a>
</li>
<li>
  <a href="contact.html">Contact</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://danstich.github.io/worst-r/">worst-r</a>
</li>
<li>
  <a href="https://github.com/danStich">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<style>
pre code, pre, code {
  white-space: pre !important;
  overflow-x: scroll !important;
  word-break: keep-all !important;
  word-wrap: initial !important;
}

.column {
    float: left;
    padding: 15px;
}

.clearfix::after {
    content: "";
    clear: both;
    display: table;
}

.content {
    width: 75%;
}

</style>
<div id="generalized-linear-models-logistic-regression"
class="section level1">
<h1>Generalized linear models: logistic regression</h1>
<p><img src="images/veligers.jpg" alt=""></p>
<h2 id="multi">
Introduction
</h2>
<p>This week in lab, we will start to take a closer look at generalized
linear models (GLM) through the lens of logisitic regression using
maximum likelihood estimation and Bayesian inference. This is a family
that includes multiple types of analyses depending on the data. For
example, we might have binary data (0, 1), binomial data (number of
success per some number of trials), or multinomial data (group
membership as a response). We will look at the simplest of these cases,
binary logistic regression, this week in the homework.</p>
<div id="the-data" class="section level2">
<h2>The data</h2>
<p>For our exercise this week, we will work with a data set from a
Biological Field Station intern project. The purpose of the project was
to test the efficacy of Virkon as a molluscicide for dissinfecting
equipment following exposure to zebra mussels <em>Dreissena
polymorpha</em>. The study examined the effects of exposure time and
concentration on mortality. The response in this data set is
<code>dead</code>, a 1/0 variable indicating whether or not a zebra
mussel was dead. Usually, with this kind of data, we use a
<code>1</code> to indicate survival, but it seemed like too much fun to
pass up the opportunity to model mortality as a success. So, for this
data set a <code>1</code> indicates dead.</p>
<p>Start by reading in the data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>vd <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/veligers.csv&quot;</span>)</span></code></pre></div>
<p>This data set contains a <em>pile</em> of variables, which of course
makes it very fun to play with. We will work with some, but not all, of
these variable this week for lab.</p>
<p>Explanations of variables are as follows:</p>
<p><code>Date</code>: calendar date for start of each lab test</p>
<p><code>Location</code>: the location in Otsego Lake, NY from which
mussels were collected</p>
<p><code>SolnAge</code>: the age of the Virkon solution</p>
<p><code>Concentration</code>: concentration of Virkon in solution</p>
<p><code>Time</code>: exposure time</p>
<p>We will treat <code>Concentration</code> as a categorical variable
because we only have a few different concentrations, although the
argument could be made to treat it as a continuous variable.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>vd<span class="sc">$</span>Concentration <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(vd<span class="sc">$</span>Concentration)</span></code></pre></div>
<p>The remaining variables are physical and chemical parameters of water
measured either in Otsego Lake, or in the Virkon solution.</p>
</div>
<div id="exercises" class="section level2">
<h2>Exercises</h2>
<h3 id="multi">
A worked example
</h3>
<p>Let’s start with a simple example to get you moving along. We are
interested in determining the effects of <code>Concentration</code> and
<code>Time</code> on the probability of zebra mussel death
(<code>dead</code>) following exposure. If you have been following
closely during the past few weeks, you will recognize that with a
categorical variable (<code>Concentration</code>) and a continuous
variable (<code>Time</code>) we are looking at something that should
resemble ANCOVA to you. <strong>But</strong>, our response,
<code>dead</code>, can only take on values of 0 and 1, so we know that
we need to use a GLM to accommodate this.</p>
<div id="analysis" class="section level4">
<h4>Analysis</h4>
<p>Start by fitting a model with additive effects of
<code>Concentration</code> and <code>Time</code> on the response
<code>dead</code> using either maximum likelihood estimation
(<code>glm()</code> function in base R) or Bayesian estimation
(<code>stan_glm()</code> function in <code>rstanarm</code>).</p>
<p>You could do it like this with the <code>glm()</code> function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>v_mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(dead <span class="sc">~</span> Concentration <span class="sc">+</span> Time, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>, <span class="at">data =</span> vd)</span></code></pre></div>
<p>Or you could fit it like this in the <code>rstanarm</code>
package:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Library</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>v_mod <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(dead <span class="sc">~</span> Concentration <span class="sc">+</span> Time,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> vd,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                  )</span></code></pre></div>
<p>Cool, that was easy!</p>
</div>
<div id="results" class="section level4">
<h4>Results</h4>
<p>Let’s have a look at what the model tells us about our biological
questions of interest now.</p>
<p>If you used <code>glm()</code> to fit the model: Remember, we need to
work with the <code>Anova()</code> function in the <code>car</code>
package to use the correct calculations because we have continuous and
categorical variables. The only difference is that we are now using an
analysis of deviance to summarize significance, which requires the use
of a Type-II test instead of a Type-III test.</p>
<p>If you used <code>stan_glm()</code> to fit the model: Remember, Stan
won’t give you p-values or significance codes, so if you want to know
whether groups are different, you need to do the math here and compare
posteriors like we did in <a
href="https://danstich.github.io/worst-r/17-2-logistic-17.html#interpretting-17">Chapter
17.2</a>.</p>
<p><strong>Question 1.</strong> At the default confidence level (<span
class="math inline">\(\alpha\)</span> = 0.05), what can you determine
about effects of <code>Concentration</code> and <code>Time</code> with
respect to statistical significance? Answer in sentence form, stating
the null hypotheses and supporting statistics.</p>
<p>Just as with all of our other models, we can use the
<code>summary()</code> function to get the output from R.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summary of the model</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(v_mod)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = dead ~ Concentration + Time, family = &quot;binomial&quot;, 
##     data = vd)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -4.3208  -0.0218   0.0214   0.2047   5.0817  
## 
## Coefficients:
##                     Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)       -13.825053   0.355912  -38.84   &lt;2e-16 ***
## Concentration0.25  11.252573   0.311103   36.17   &lt;2e-16 ***
## Concentration0.5   12.201641   0.325214   37.52   &lt;2e-16 ***
## Concentration1     13.407026   0.344278   38.94   &lt;2e-16 ***
## Concentration2     13.527866   0.342963   39.44   &lt;2e-16 ***
## Concentration3     13.464877   0.345367   38.99   &lt;2e-16 ***
## Time                0.182631   0.005109   35.75   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 15731.0  on 12108  degrees of freedom
## Residual deviance:  4989.6  on 12102  degrees of freedom
## AIC: 5003.6
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<p>The summary of the model gives us the estimated coefficients
<strong>on the logit scale</strong>, along with our usual significance
codes and an AIC score (now in the default output because we are using
maximum likelihood estimation).</p>
<p>Even though these parameters are on the logit scale, we can still
make limited inference about the direction of relationships as we would
with linear models used earlier in the semester.</p>
<p><strong>Question 2.</strong> What, if any, is the direction of the
relationship between <code>Time</code> and zebra mussel mortality?</p>
<p><strong>Question 3.</strong> What is the general trend in mortality
with the different concentrations listed in the <code>summary</code> of
<code>vmod</code>? This may take a little thought, but remember that
even as categorical variables, factor levels are listed alphanumerically
in the output. If <code>Concentration == 0</code> (“control”) is in the
intercept, then the remaining coefficients are directly comparable.</p>
<!-- Here, we see that the coefficient for `Time` is positive (0.183), meaning that we would predict probability of `dead` to be directly proportional to `Time` (higher probability of death following increased exposure time). This, of course, seems perfectly reasonable. -->
<p>One thing that you’ll notice is missing from this output is the
R<sup>2</sup> value that we have become familiar with during the past
several weeks while working with linear models. There is no
R<sup>2</sup> value because we are no longer estimating these models
using ordinary least squares, but rather maximum likelihood estimation
or Bayesian inference.</p>
<p>Under Bayesian inference in the <code>rstanarm</code> package, we can
just use the <code>bayes_R2()</code> function to get this.</p>
<p>If we wanted to get an analagous metric of variance explained by our
model for the MLE fit using <code>glm()</code> output, we could estimate
a <em>pseudo-R<sup>2</sup></em>. There are many of these available
depending on the model and nature of our data. The simplest, and
arguably most common is the <strong>McFadden R<sup>2</sup></strong>. To
estimate this one, we compare the deviance of our model to the deviance
of an intercept-only (i.e. “null”) model using the output from the
<code>summary</code> function above:</p>
<p><span class="math display">\[McFadden R^2 = 1 -
\frac{Deviance_{residual}}{Deviance_{null}}\]</span></p>
<p>In R, the residual deviance is stored in <code>v_mod$deviance</code>
and the null deviance is stored in <code>v_mod$null.deviance</code>.</p>
<!-- Here, we can see that the model only explains about 68% of the variation in the response of interest: -->
<p><strong>Question 4.</strong> How much of the variation in zebra
mussel mortality is explained by the additive effects of
<code>Concentration</code> and <code>Time</code>?</p>
<p>Now that we have a feel for just how much variability this model
explains, the next step in reporting our results here is to extract some
information about how <code>dead</code> changes with <code>Time</code>
beyond simply stating that it was either “inversely” or “proportionally”
related to <code>Time</code>. We will include <code>Concentration</code>
in our predictions to account for changes between doses.</p>
<p>Recall that we can make predictions from our model either by hand or
by using the <code>predict</code> function in R. <strong>Note</strong>
that if we use the <code>predict()</code> function for <code>glm</code>
or <code>stan_glm</code> objects in R, we no longer have the ability to
set the <code>interval</code> argument as we did for objects resulting
from the <code>lm()</code> function (well, we can - it will just be
ignored). But, we can get standard error estimates if we make
predictions on the link scale and specify <code>se.fit = TRUE</code>.
Therefore, if we want confidence intervals on our predictions, we will
need to do it by hand (well, in the computer).</p>
<p>Start by making some predictions. Recall from that this gets a little
more complicated when we have multiple explanatory variables. The
<code>predict</code> function requires a <code>data.frame</code> with
<code>names</code> that match the <code>names</code> of explanatory
variables from our original data set, <code>vd</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean predicted value and SE for the predictions</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># on the link scale</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>logit_preds <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">predict</span>(v_mod, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>) )</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Now get lower and upper CIs</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>logit_preds<span class="sc">$</span>lwr <span class="ot">&lt;-</span> logit_preds<span class="sc">$</span>fit <span class="sc">+</span> logit_preds<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>logit_preds<span class="sc">$</span>upr <span class="ot">&lt;-</span> logit_preds<span class="sc">$</span>fit <span class="sc">+</span> logit_preds<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)</span></code></pre></div>
<p>Now, we need to define a function to invert the logit link function
if we want to get our predictions back on the probability scale (and we
do). If you fit this model using <code>rstanarm</code> you can use the
<code>invlogit()</code> function that ships with it.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>invlogit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(x))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we can convert our predictions to the probability scale. Here, we
loop over columns 1, 3, and 4 of our <code>preds</code> dataframe using
the <code>apply</code> function because the second column is just the
standard errors for our predicted fit at each point. This gives us mean
and 95% CI on the probability scale.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the predictions to the probability scale</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>real_preds <span class="ot">&lt;-</span> <span class="fu">apply</span>(logit_preds, <span class="dv">2</span>, invlogit)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add our predictions back to the original data</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>vd_preds <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(vd, real_preds)</span></code></pre></div>
<p>Finally, let’s plot our predictions. Note that here we will plot our
raw data as the proportion of zebra mussels dead at a given time and
concentration by trial (date). Here is my graph:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize proportion dead at time by concentration</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use dates so we can show reps</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>sum_points <span class="ot">&lt;-</span> vd_preds <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Concentration, Time, Date) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">props =</span> <span class="fu">sum</span>(dead)<span class="sc">/</span><span class="fu">length</span>(dead))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the predictions</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(vd_preds, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> lwr, <span class="at">ymax =</span> upr, <span class="at">fill =</span> Concentration), <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> Concentration)) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> props, <span class="at">color =</span> Concentration), <span class="at">data =</span> sum_points,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Hours&quot;</span>) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Probability of mortality&quot;</span>) <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="hw08_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Using either the graph or the estimates in the <code>fit</code>
column of <code>preds</code>, we can estimate about how much
<code>dead</code> changes across the range of <code>Time</code>
observed. We can report this by <code>Concentration</code> to convey
more information.</p>
<p><strong>Question 5.</strong> Use the graph you have created, along
with the model results to describe how zebra mussel mortality changed
with <code>Concentration</code> and <code>Time</code> in paragraph form.
Be sure to report the relevant test statistics along with your answer.
This requires you to put together the info from each of the previous
questions.</p>
</div>
</div>
</div>

<!DOCTYPE html>

<br>

<hr>

<p style="color:gray">This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/legalcode">Creative Commons Attribution 4.0 International License.</a></p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
